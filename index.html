<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‚úâÔ∏è</title>
  <meta name="description" content="‡∏Å‡∏î‡∏ã‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (EmailJS)" />
  <meta name="theme-color" content="#f59e0b">
  <style>
    :root{
      --bg1:#0f172a; --bg2:#1e293b; --accent:#f59e0b; --accent2:#f97316;
      --paper:#fffaf0; --ink:#0b1324;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Kantumruy Pro, Noto Sans Thai, sans-serif;
      color:#e2e8f0; background: radial-gradient(1000px 600px at 20% 10%, #1b2845 0%, var(--bg1) 40%),
                       radial-gradient(800px 600px at 80% 90%, #1f2937 0%, var(--bg2) 40%),
                       linear-gradient(180deg, var(--bg1), var(--bg2));
      display:grid; place-items:center; padding:24px;
    }
    .wrap{max-width:900px; width:100%; display:flex; flex-direction:column; gap:18px; align-items:center}
    h1{font-weight:700; margin:0; text-align:center; font-size:1rem; opacity:.85}
    p.lead{opacity:.9; margin:0; text-align:center; font-size:.9rem}
    .stage{width:min(420px, 90vw); height:min(300px, 64vw); position:relative; perspective:1000px; user-select:none}
    .envelope{position:absolute; inset:0; transform-style:preserve-3d; cursor:pointer}
    .env-body{position:absolute; inset:0; background:linear-gradient(180deg, #ffe8c2, #ffd79a); border-radius:18px; box-shadow:0 20px 60px rgba(0,0,0,.35), inset 0 0 0 2px rgba(0,0,0,.08)}
    .flap{position:absolute; left:0; right:0; top:0; height:55%; transform-origin:50% 0%; background:linear-gradient(180deg, #ffedd5, #fdba74); clip-path:polygon(0 0, 100% 0, 50% 100%); border-top-left-radius:18px; border-top-right-radius:18px; box-shadow:inset 0 -2px 0 rgba(0,0,0,.06)}
    .seal{position:absolute; top:47%; left:50%; transform:translate(-50%, -50%); width:64px; height:64px; background:radial-gradient(circle at 30% 30%, #fff, #ffe4b5 50%, #eab308 80%); border-radius:999px; box-shadow:0 4px 12px rgba(0,0,0,.25), inset 0 0 0 2px rgba(0,0,0,.15)}
    .seal:after{content:"‚ú≥Ô∏é"; position:absolute; inset:0; display:grid; place-items:center; color:#1f2937; font-size:28px; opacity:.8}
    .paper{position:absolute; left:5%; right:5%; top:20%; bottom:10%; background:var(--paper); border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.25); transform:translateZ(1px); display:grid; place-items:center; padding:20px; overflow:hidden}
    .paper > div{color:var(--ink); text-align:center; padding:8px 10px; font-weight:700; letter-spacing:.2px}
    .envelope:not(.open){animation:floaty 3.5s ease-in-out infinite}
    @keyframes floaty{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
    .envelope.open .flap{animation: openFlap .9s cubic-bezier(.2,.7,.2,1) forwards}
    @keyframes openFlap{0%{transform:rotateX(0deg)} 60%{transform:rotateX(-165deg)} 100%{transform:rotateX(-160deg)}}
    .envelope.open .seal{opacity:0; transform:translate(-50%,-50%) scale(0.6); transition:all .3s ease-out}
    .envelope.open .paper{animation: slideUp 1s .35s ease-out forwards}
    @keyframes slideUp{from{transform:translateZ(2px) translateY(0)} to{transform:translateZ(40px) translateY(-46%)} }
    .card{background:var(--paper); color:var(--ink); border-radius:14px; padding:18px; box-shadow:0 12px 30px rgba(0,0,0,.35); width:min(640px, 92vw)}
    .q{font-size:1.15rem; line-height:1.6; font-weight:800; margin:0 0 12px}
    textarea{width:100%; min-height:120px; padding:12px; border-radius:10px; border:1px solid #cbd5e1; font-size:1rem; resize:vertical}
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .input{flex:1; min-width:180px; padding:10px 12px; border-radius:10px; border:1px solid #cbd5e1; font-size:1rem}
    .btn{appearance:none; border:0; padding:12px 16px; border-radius:999px; background:linear-gradient(90deg, var(--accent), var(--accent2)); color:#0b1020; font-weight:800; letter-spacing:.2px; cursor:pointer; box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .btn.alt{background:#0b1020; color:#e2e8f0; border:1px solid rgba(255,255,255,.12)}
    .muted{opacity:.8; font-size:.9rem}
    .hidden{display:none}
    #confetti{position:fixed; inset:0; pointer-events:none}
    .toast{position:fixed; bottom:16px; left:50%; transform:translateX(-50%); background:#0b1020; color:#e2e8f0; border:1px solid rgba(255,255,255,.12); padding:10px 14px; border-radius:999px; opacity:0; pointer-events:none}
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>
  <div class="wrap">
    <h1>‚úâÔ∏è ‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</h1>
    <p class="lead">‡∏Å‡∏î‡∏ã‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>

    <div class="stage" aria-label="‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°">
      <div class="envelope" id="envelope" role="button" tabindex="0" aria-pressed="false">
        <div class="env-body"></div>
        <div class="flap"></div>
        <div class="paper" aria-hidden="true"><div>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î ‚ú®</div></div>
        <div class="seal" title="‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á"></div>
      </div>
    </div>

    <div class="card hidden" id="formCard">
      <div class="q" id="question">‚Ä¶</div>
      <textarea id="answer" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
      <div class="row">
        <input class="input" id="sender" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)" />
        <input class="input" id="reply" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" type="email"/>
      </div>
      <div class="row">
        <button class="btn" id="sendBtn">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏î‡∏¢‡πå</button>
        <button class="btn alt" id="newQ">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏≠‡∏∑‡πà‡∏ô</button>
      </div>
      <p class="muted">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô EmailJS ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¢‡πå</p>
    </div>
  </div>

  <div class="toast" id="toast">‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏Å‡∏ô‡∏∞ üíõ</div>

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

  <script>
    // ===== EmailJS config (‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¢‡πå) =====
    const EMAILJS_PUBLIC_KEY = "vQoiBKShUflegc3JG";
    const EMAILJS_SERVICE_ID = "service_wgigx4l";
    const EMAILJS_TEMPLATE_ID = "template_epwxspk";
    emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });

    // ===== UI helpers =====
    const $ = (s)=>document.querySelector(s);
    const toast = $('#toast');
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(()=> toast.classList.remove('show'), 1800);
    }

    // ===== Question bank (‡∏™‡∏∏‡πà‡∏°) =====
    const RAW_QUESTIONS = [
      "‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á",
      "‡∏ô‡∏≠‡∏ô‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏°‡∏±‡πâ‡∏¢",
      "‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏ö‡πâ‡∏≤‡∏á",
      "‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏∞‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏°‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏°‡∏±‡πâ‡∏¢",
      "‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î",
      "‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏Ñ‡∏¥‡∏î‡πÄ‡∏¢‡∏≠‡∏∞ ‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î",
      "‡∏°‡∏µ‡∏Ñ‡∏ô‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏∞‡∏£‡∏π‡πâ‡∏°‡∏±‡πâ‡∏¢",
      "‡∏°‡∏µ‡∏Ñ‡∏ô‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏Å‡∏≠‡∏î‡πÄ‡∏Ç‡∏≤‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ ‡∏ß‡∏±‡∏ô‡∏ô‡∏∞",
      "‡∏°‡∏µ‡∏Ñ‡∏ô‡∏£‡∏≠‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏∞"
    ];
    const params = new URLSearchParams(location.search);
    const nameParam = params.get('name') || '‡∏Ñ‡∏∏‡∏ì';
    const QUESTIONS = RAW_QUESTIONS.map(q => q.replace("‡∏Ñ‡∏∏‡∏ì", nameParam));

    const envelope = $('#envelope');
    const formCard = $('#formCard');
    const questionEl = $('#question');
    const answerEl = $('#answer');
    const senderEl = $('#sender');
    const replyEl = $('#reply');
    const sendBtn = $('#sendBtn');  // ‚úÖ bug fixed: was $('#sendBtn']
    const newQBtn = $('#newQ');

    function pickQuestion(){
      const i = Math.floor(Math.random() * QUESTIONS.length);
      return QUESTIONS[i];
    }
    function openEnvelope(){
      envelope.classList.add('open');
      setTimeout(()=>{
        questionEl.textContent = pickQuestion();
        formCard.classList.remove('hidden');
        startConfettiBurst();
      }, 650);
    }
    envelope.addEventListener('click', openEnvelope);
    envelope.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); openEnvelope(); }
    });
    newQBtn.addEventListener('click', ()=>{
      questionEl.textContent = pickQuestion();
      answerEl.focus();
    });

    // ===== Send via EmailJS =====
    async function sendAnswer(){
      const q = questionEl.textContent.trim();
      const a = answerEl.value.trim();
      const s = senderEl.value.trim();
      const r = replyEl.value.trim();
      if(!a){ showToast("‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡πâ‡∏≤"); answerEl.focus(); return; }

      sendBtn.disabled = true; sendBtn.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...";
      try{
        await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
          question: q,
          answer: a,
          sender: s || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",
          reply: r || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",
          page_url: location.href,
          user_agent: navigator.userAgent,
          name: s || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",
          email: r || "",
          message: `‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°: ${q}\n‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö: ${a}\n\n‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á: ${s || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}\n‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö: ${r || ""}\n\nPage: ${location.href}`
        });
        showToast("‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏Å‡∏ô‡∏∞ üíõ");
        answerEl.value = "";
      }catch(err){
        console.error(err);
        showToast("‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
      }finally{
        sendBtn.disabled = false; sendBtn.textContent = "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏î‡∏¢‡πå";
      }
    }
    sendBtn.addEventListener('click', sendAnswer);

    // ===== Confetti (simple) =====
    const cv = document.getElementById('confetti');
    const ctx = cv.getContext('2d');
    function resize(){ cv.width = innerWidth; cv.height = innerHeight }
    addEventListener('resize', resize); resize();
    let parts = [];
    function startConfettiBurst(){
      const count = 120;
      parts = [];
      for(let i=0;i<count;i++){
        parts.push({
          x: innerWidth/2 + (Math.random()*120-60), y: innerHeight/2,
          vx: (Math.random()-0.5)*6, vy: -Math.random()*7-3,
          size: Math.random()*6+3, rot: Math.random()*Math.PI, vr: (Math.random()-0.5)*0.2,
          life: Math.random()*1.2+0.8
        });
      }
      let t0 = performance.now();
      function tick(t){
        const dt = Math.min(0.033, (t - t0)/1000); t0 = t;
        ctx.clearRect(0,0,cv.width,cv.height);
        parts.forEach(p=>{
          p.vy += 9.8*dt*0.9;
          p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.life -= dt*0.8;
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot);
          ctx.fillStyle = `hsl(${Math.random()*360}, 90%, 60%)`;
          ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
          ctx.restore();
        });
        parts = parts.filter(p=> p.life>0 && p.y < innerHeight+40);
        if(parts.length) requestAnimationFrame(tick); else ctx.clearRect(0,0,cv.width,cv.height);
      }
      requestAnimationFrame(tick);
    }

    // Auto open
    if(new URLSearchParams(location.search).get('auto')==='1'){
      setTimeout(openEnvelope, 400);
    }
  </script>
</body>
</html>
