<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£ ‚úâÔ∏è</title>
  <meta name="description" content="‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)" />
  <!-- Basic social preview (edit after hosting) -->
  <meta property="og:title" content="‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üíå">
  <meta property="og:description" content="‡∏Å‡∏î‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏µ ‡πÜ ‡∏à‡∏∞‡πÄ‡∏î‡πâ‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì">
  <meta property="og:type" content="website">
  <meta name="theme-color" content="#f59e0b">
  <style>
    :root{
      --bg1:#0f172a; /* slate-900 */
      --bg2:#1e293b; /* slate-800 */
      --accent:#f59e0b; /* amber-500 */
      --accent-2:#f97316; /* orange-500 */
      --paper:#fffaf0; /* ivory-ish */
      --ink:#0b1324;
      --success:#22c55e;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Kantumruy Pro, Noto Sans Thai, sans-serif;
      color:#e2e8f0; background: radial-gradient(1000px 600px at 20% 10%, #1b2845 0%, var(--bg1) 40%),
                       radial-gradient(800px 600px at 80% 90%, #1f2937 0%, var(--bg2) 40%),
                       linear-gradient(180deg, var(--bg1), var(--bg2));
      display:grid; place-items:center; padding:24px;
    }
    .wrap{max-width:900px; width:100%; display:flex; flex-direction:column; gap:24px; align-items:center}
    h1{font-weight:800; margin:0; letter-spacing:.3px; text-align:center}
    p.lead{opacity:.9; margin:0; text-align:center}

    /* Envelope stage */
    .stage{width:min(420px, 90vw); height:min(300px, 64vw); position:relative; perspective:1000px; user-select:none}
    .envelope{position:absolute; inset:0; transform-style:preserve-3d; cursor:pointer}
    .env-body{position:absolute; inset:0; background:linear-gradient(180deg, #ffe8c2, #ffd79a); border-radius:18px; box-shadow:0 20px 60px rgba(0,0,0,.35), inset 0 0 0 2px rgba(0,0,0,.08)}
    .flap{position:absolute; left:0; right:0; top:0; height:55%; transform-origin:50% 0%; background:linear-gradient(180deg, #ffedd5, #fdba74); clip-path:polygon(0 0, 100% 0, 50% 100%); border-top-left-radius:18px; border-top-right-radius:18px; box-shadow:inset 0 -2px 0 rgba(0,0,0,.06)}
    .seal{position:absolute; top:47%; left:50%; transform:translate(-50%, -50%); width:64px; height:64px; background:radial-gradient(circle at 30% 30%, #fff, #ffe4b5 50%, #eab308 80%); border-radius:999px; box-shadow:0 4px 12px rgba(0,0,0,.25), inset 0 0 0 2px rgba(0,0,0,.15)}
    .seal:after{content:"‚ú≥Ô∏é"; position:absolute; inset:0; display:grid; place-items:center; color:#1f2937; font-size:28px; opacity:.8}
    .paper{position:absolute; left:5%; right:5%; top:20%; bottom:10%; background:var(--paper); border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.25); transform:translateZ(1px); display:grid; place-items:center; padding:20px; overflow:hidden}
    .paper > div{color:var(--ink); text-align:center; padding:8px 10px; font-weight:700; letter-spacing:.2px}

    /* Idle animation */
    .envelope:not(.open){animation:floaty 3.5s ease-in-out infinite}
    @keyframes floaty{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
    .seal{animation: pulse 2.2s ease-in-out infinite}
    @keyframes pulse{0%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.06)}100%{transform:translate(-50%,-50%) scale(1)}}

    /* Open state */
    .envelope.open .flap{animation: openFlap .9s cubic-bezier(.2,.7,.2,1) forwards}
    @keyframes openFlap{0%{transform:rotateX(0deg)} 60%{transform:rotateX(-165deg)} 100%{transform:rotateX(-160deg)}}
    .envelope.open .seal{opacity:0; transform:translate(-50%,-50%) scale(0.6); transition:all .3s ease-out}
    .envelope.open .paper{animation: slideUp 1s .35s ease-out forwards}
    @keyframes slideUp{from{transform:translateZ(2px) translateY(0)} to{transform:translateZ(40px) translateY(-46%)} }

    /* CTA */
    .cta{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
    .btn{appearance:none; border:0; padding:12px 16px; border-radius:999px; background:linear-gradient(90deg, var(--accent), var(--accent-2)); color:#0b1020; font-weight:800; letter-spacing:.2px; cursor:pointer; box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .btn.secondary{background:#0b1020; color:#e2e8f0; outline:1px solid rgba(255,255,255,.12)}

    /* Dialog */
    dialog{width:min(560px, 92vw); border:0; border-radius:18px; padding:0; overflow:hidden; box-shadow:0 30px 80px rgba(0,0,0,.5); background:linear-gradient(180deg, #0b1020, #0f172a)}
    .dlg-head{padding:16px 20px; display:flex; justify-content:space-between; align-items:center; background:linear-gradient(90deg, #111827, #0b1020)}
    .dlg-title{font-weight:800}
    .dlg-body{padding:20px; background:
      radial-gradient(500px 200px at 10% -10%, rgba(245,158,11,.15), transparent),
      radial-gradient(400px 200px at 90% 110%, rgba(249,115,22,.15), transparent)}
    .wish-card{background:var(--paper); color:var(--ink); border-radius:14px; padding:18px; font-size:1.15rem; line-height:1.6; box-shadow:0 12px 30px rgba(0,0,0,.35)}
    .dlg-actions{display:flex; gap:10px; justify-content:flex-end; padding:16px 20px; background:#0b1020}

    .tag{font-size:.78rem; opacity:.8}
    .toast{position:fixed; bottom:18px; left:50%; transform:translateX(-50%); background:#0b1020; color:#e2e8f0; border:1px solid rgba(255,255,255,.12); padding:10px 14px; border-radius:999px; opacity:0; pointer-events:none}
    .toast.show{opacity:1}

    /* Confetti canvas */
    #confetti{position:fixed; inset:0; pointer-events:none}
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>
  <div class="wrap">
    <h1>‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üéâ</h1>
    <p class="lead">‡∏Å‡∏î‡∏ó‡∏µ‡πà <strong>‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏µ ‡πÜ ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)</p>

    <div class="stage" id="stage" aria-label="‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£">
      <div class="envelope" id="envelope" role="button" tabindex="0" aria-pressed="false">
        <div class="env-body"></div>
        <div class="flap"></div>
        <div class="paper" aria-hidden="true">
          <div>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î ‚ú®</div>
        </div>
        <div class="seal" title="‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á"></div>
      </div>
    </div>

    <div class="cta">
      <button class="btn" id="shareBtn">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ</button>
      <button class="btn secondary" id="rerollBtn" title="‡∏™‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà (‡∏ó‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)">‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)</button>
    </div>

    <p class="tag">Tip: ‡πÄ‡∏û‡∏¥‡πà‡∏° <code>?name=‡πÄ‡∏î‡∏¢‡πå</code> ‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° üíå</p>
  </div>

  <dialog id="wishDialog">
    <div class="dlg-head">
      <div class="dlg-title">‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üí´</div>
      <form method="dialog"><button class="btn secondary">‡∏õ‡∏¥‡∏î</button></form>
    </div>
    <div class="dlg-body">
      <div class="wish-card" id="wishText">‚Ä¶</div>
    </div>
    <div class="dlg-actions">
      <button class="btn secondary" id="copyWish">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
      <button class="btn" id="openAgain">‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
    </div>
  </dialog>

  <div class="toast" id="toast">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!</div>

  <script>
    // ===== Utilities =====
    const $ = (sel) => document.querySelector(sel);
    const params = new URLSearchParams(location.search);
    const nameParam = params.get('name');

    // Wish bank (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
    const WISHES = [
      "{name} ‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡∏ö‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á üíó "
      "{name} ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏á‡∏ö‡πâ‡∏≤‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡∏°‡∏±‡πâ‡∏¢ üíù"
      "{name} ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ‡∏ô‡∏∞ ‚ô•Ô∏è "
    ];

    function personalize(text){
      const name = nameParam || '‡∏Ñ‡∏∏‡∏ì';
      return text.replaceAll('{name}', name);
    }

    // Pick once per device (localStorage). Allow "reroll" with button.
    const STORAGE_KEY = 'lucky-envelope-wish-index-v1';
    function getStoredIndex(){
      const v = localStorage.getItem(STORAGE_KEY);
      return v === null ? null : parseInt(v, 10);
    }
    function randomIndex(){
      // crypto-strong random
      const arr = new Uint32Array(1);
      crypto.getRandomValues(arr);
      return arr[0] % WISHES.length;
    }
    function assignIfNeeded(forceNew=false){
      let idx = getStoredIndex();
      if(idx === null || forceNew){
        idx = randomIndex();
        localStorage.setItem(STORAGE_KEY, String(idx));
      }
      return idx;
    }

    // ===== Envelope open flow =====
    const envelope = $('#envelope');
    const dialogEl = $('#wishDialog');
    const wishText = $('#wishText');

    function openEnvelope(showConfetti=true){
      envelope.classList.add('open');
      envelope.setAttribute('aria-pressed','true');
      // Wait a bit for paper to rise then show dialog
      setTimeout(()=>{
        const idx = assignIfNeeded(false);
        wishText.textContent = personalize(WISHES[idx]);
        dialogEl.showModal();
        if(showConfetti) startConfettiBurst();
      }, 680);
    }

    envelope.addEventListener('click', ()=> openEnvelope(true));
    envelope.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); openEnvelope(true); }
    });

    // Buttons
    $('#openAgain').addEventListener('click', ()=>{
      dialogEl.close();
      setTimeout(()=>{ envelope.classList.remove('open'); envelope.offsetHeight; openEnvelope(false); }, 120);
    });

    $('#copyWish').addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(wishText.textContent); showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß'); }catch{ showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); }
    });

    $('#shareBtn').addEventListener('click', async ()=>{
      const url = location.href;
      try{
        if(navigator.share){ await navigator.share({title: document.title, text: '‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üíå', url}); }
        else{ await navigator.clipboard.writeText(url); showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß'); }
      }catch{}
    });

    $('#rerollBtn').addEventListener('click', ()=>{
      assignIfNeeded(true);
      showToast('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß');
    });

    // ===== Toast =====
    const toast = $('#toast');
    let toastTimer = null;
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toast.classList.remove('show'), 1600);
    }

    // ===== Confetti (simple) =====
    const cv = $('#confetti');
    const ctx = cv.getContext('2d');
    let parts = [];
    function resize(){ cv.width = innerWidth; cv.height = innerHeight }
    addEventListener('resize', resize); resize();

    function startConfettiBurst(){
      const count = 120;
      parts = [];
      for(let i=0;i<count;i++){
        parts.push({
          x: innerWidth/2 + (Math.random()*120-60), y: innerHeight/2,
          vx: (Math.random()-0.5)*6, vy: -Math.random()*7-3,
          size: Math.random()*6+3, rot: Math.random()*Math.PI, vr: (Math.random()-0.5)*0.2,
          life: Math.random()*1.2+0.8
        });
      }
      let t0 = performance.now();
      function tick(t){
        const dt = Math.min(0.033, (t - t0)/1000); t0 = t;
        ctx.clearRect(0,0,cv.width,cv.height);
        parts.forEach(p=>{
          p.vy += 9.8*dt*0.9; // gravity
          p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.life -= dt*0.8;
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot);
          ctx.fillStyle = `hsl(${Math.random()*360}, 90%, 60%)`;
          ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
          ctx.restore();
        });
        parts = parts.filter(p=> p.life>0 && p.y < innerHeight+40);
        if(parts.length) requestAnimationFrame(tick); else ctx.clearRect(0,0,cv.width,cv.height);
      }
      requestAnimationFrame(tick);
    }

    // Auto-open if ?auto=1
    if(new URLSearchParams(location.search).get('auto')==='1'){
      setTimeout(()=> openEnvelope(true), 400);
    }
  </script>
</body>
</html>
